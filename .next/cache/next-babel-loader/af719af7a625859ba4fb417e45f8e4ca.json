{"ast":null,"code":"import { db } from '../lib/db';\nimport { distance } from '../lib/geo';\nimport admin from 'firebase-admin';\nimport { getCurrentDate } from '../lib/datetime';\nexport const checkExists = async user => {\n  const currentDate = getCurrentDate();\n  const todaysCheckin = await db.collection('markers').doc(currentDate).collection('checks').doc(user).get();\n  const todaysData = todaysCheckin.data();\n  return todaysData;\n};\nexport const findChecksNearbyCheckin = async checkin => {\n  const currentDate = getCurrentDate();\n  const checkins = await db.collection('markers').doc(currentDate).collection('checks').near({\n    center: checkin.coordinates,\n    radius: 1000\n  }).get();\n  const checkinsList = [];\n  checkins.docs.forEach(doc => {\n    checkinsList.push({\n      id: doc.id,\n      status: doc.data().status,\n      coords: {\n        lat: doc.data().coordinates.latitude,\n        long: doc.data().coordinates.longitude\n      },\n      distance: distance(checkin.coordinates.latitude, // -22.20292, //\n      checkin.coordinates.longitude, // -45.94367, //\n      doc.data().coordinates.latitude, doc.data().coordinates.longitude).toFixed(2)\n    });\n  });\n  return checkinsList;\n};\nexport const setStatus = async (user, dados) => {\n  const currentDate = getCurrentDate();\n  await db.collection('markers').doc(currentDate).collection('checks').doc(user).set({\n    status: dados.status,\n    user: user,\n    coordinates: new admin.firestore.GeoPoint(dados.coords.lat, dados.coords.long)\n  });\n};","map":null,"metadata":{},"sourceType":"module"}